# 엘라스틱서치 살펴보기
- ## 엘라스틱서치를 구성하는 개념
  -  ### 기본용어
     - _인덱스_ 
       - 인덱스는 데이터 저장공간으로 하나의 타입만 가진다.
       - 하나의 물리적인 노드에 여러 개의 논리적인 인덱스를 생성할 수 있다. (멀티테넌시)
       - 분산환경 구성시 하나의 인덱스(데이터베이스가) 여러 노드에 분산 저장되어 관리  
       - 기본적으로 5개의 프라이머리 샤드와 1개의 레플리카 샤드 세트를 생성한다.
     - _샤드_ 
       - 인덱스 내부에 색인된 데이터는 물리적인 공간에 여러 개의 파티션으로 구성되는데, 이를 샤드라고 부른다
     - _타입_
       - 문서타입은 인덱스의 논리적 구조를 의미
       - 6.0 이하에서는 하나의 인덱스에 여러 타입을 설정가능 했지만 6.1이후 부터는 인덱스에 하나의 타입만 사용가능 하다.
     - _문서_
       - 엘라스틱서치에서 데이터가 저장되는 최소단위 (RDB의 row)
     - _필드_
       - 문서를 구상하기 위한 속성이라고 할 수 있다.
       - RDB의 컬럼의 데이터 타입은 정적인 것에 반해 엘라스틱서치의 필드는 동적인 데이터 타입이라 할 수 있다.
     - _매핑_
       - 문서의 필드와 필드 속성을 정의하고 그에 따른 색인 방법을 정의하는 프로세스
       - 필드명 중복 불가 
    - ### 노드와 클러스터
      - 클러스터는 물리적인 노드 인스턴스의 모임
      - 클러스터는 모든 노드의 검색과 색인 작업을 관장하는 논리적인차 개념이라 할 수 있음
    - ### 노드의 종류
      - 마스터노드 
        - 노드 추가 제거와 같은 클러스터 관리 담당
        - 네트워크 속도가 빠르고 지연없는 노드를 마스터 선정해야함
      - 데이터 노드
        - 실질적인 데이터를 저장
        - 검색과 통계 같은 데이터 관련 작업수행
        - 마스터 노드와 물리적으로 분리하는게 좋음 (리소스 많이 사용,모니터링 필요)
      - 코디네이팅 노드
        - 사용자의 요청만 받아서 처리
        - 클러스터 관련 요청은 마스터 노드에 전달하고 데이터 관련 요청은 데이터노드에 전달
      - 인제스트 노드
        - 문서의 전처리 작업 담당
    - ### 샤딩
      - 클러스터에 있는 노드는 실시간으로 추가 제거가 가능함
      - 인덱스를 생성할 때 별도의 설정을 하지 않으면 7.0 버전부터는 디폴트로 1개의 샤드로 인덱스가 구성되며 6.x 이하 버전에서는 5개로 구성
      - 데이터 가용성과 무결성을 위해 최소 3개의 노드로 구성 할 것을 권장
      - 설정시에 레플리카 샤드는 세트로 구성한다 ex) 프라이머리 샤드 3개 레플리카 샤드 1세트 => 1세트는 프라이머리 샤드 개수와 동일
    - ### 스키마리스 기능은 사용하지 말자
        - 문제점 
          - 모든 필드가 text 타입과 keyword 타입의 멀티필드로 구성됌 (keyword 타입은 단순 문자열 저장 및 통계 , text 타입은 형태소 분석을 원할경우 사용)
          - 공간낭비 => 색인 속도 저하 => 데이터가 커지면 검색 속도 저하
    
    - ### api 종류
      - 인덱스 관리 api (ddl)
      - 문서 관리 api (dml)
      - 검색 api (select)
        - single document api
          - index api -> 한건 문서 색인
          - get api -> 한건 문서 조회
          - delete api -> 한건 문서 삭제
          - update api -> 한건 문서 수정
        - multi-document api
          - multi get api -> 다수의 문서 조회
          - bulk api -> 대량 문서 색인
          - delete by query api -> 다수의 문서 삭제
          - update by query api -> 다수의 문서 수정
          - reindex api -> 인덱스 문서 재색인
      - 집계 api (max,min,avg,sum,count....)


